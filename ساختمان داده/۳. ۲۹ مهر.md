# جزوه ساختمان داده - ضرب ماتریس‌ها و ماتریس پراکنده

---

## کد ضرب ماتریس در C

### تابع ضرب سه ماتریس:

```c
void Multiply(m₁[i][j], m₂[j][k], m₃[i][k])
{
    int i, j, k;
    
    for(i = 0; i < n; i++)
        for(j = 0; j < n; j++)
            for(k = 0; k < n; k++)
                m₃[i][k] = m₁[i][j] × m₂[j][k];
}
```

---

## مثال عملی ضرب ماتریس

### محاسبه:

```
[0  1  2]   [5]   [0×5 + 1×1 + 2×4]
[2  4 -1] × [1] = [2×5 + 4×1 + (-1)(4)]
            [4]
 2×3       3×1

نتیجه محاسبات:
= [0 + 1 + 8]   = [9]
  [10 + 4 - 4]    [10]
```

**ابعاد نهایی:** `2×1`

---

## بهینه‌سازی ترتیب ضرب ماتریس‌ها

### مسئله:

**سوال:** ضرب ۳ ماتریس `C₂₀ₓ₄`, `B₁₀ₓ₂₀`, `A₅ₓ₁₀` را به چه ترتیبی انجام دهیم تا سریع‌تر اجرا شود؟

---

### حالت 1: `((AB)C)`

**مرحله اول:** `A₅ₓ₁₀ × B₁₀ₓ₂₀ = (AB)₅ₓ₂₀`

```
تعداد ضرب‌ها: 5 × 10 × 20 = 1000
```

**مرحله دوم:** `(AB)₅ₓ₂₀ × C₂₀ₓ₄`

```
تعداد ضرب‌ها: 5 × 20 × 4 = 400
```

**جمع کل:** `1000 + 400 = 1400 ضرب`

---

### حالت 2: `(A(BC))`

**مرحله اول:** `B₁₀ₓ₂₀ × C₂₀ₓ₄ = (BC)₁₀ₓ₄`

```
تعداد ضرب‌ها: 10 × 20 × 4 = 800
```

**مرحله دوم:** `A₅ₓ₁₀ × (BC)₁₀ₓ₄`

```
تعداد ضرب‌ها: 5 × 10 × 4 = 200
```

**جمع کل:** `800 + 200 = 1000 ضرب`

---

### نتیجه‌گیری:

✅ **ترتیب بهینه:** `(A(BC))` با **1000 ضرب**  
❌ **ترتیب غیربهینه:** `((AB)C)` با **1400 ضرب**

> **نکته:** ترتیب ضرب ماتریس‌ها تأثیر زیادی بر تعداد عملیات دارد!

---

## مثال دوم: بهینه‌سازی ضرب ماتریس

### داده‌ها:

- `A₃ₓ₄`
- `B₄ₓ₆`
- `C₆ₓ₂`

### حالت 1: `((AB)C)`

**مرحله اول:** `A₃ₓ₄ × B₄ₓ₆ = (AB)₃ₓ₆`

```
تعداد ضرب‌ها: 3 × 4 × 6 = 72
```

**مرحله دوم:** `(AB)₃ₓ₆ × C₆ₓ₂`

```
تعداد ضرب‌ها: 3 × 6 × 2 = 36
```

**جمع کل:** `72 + 36 = 108 ضرب`

---

### حالت 2: `(A(BC))`

**مرحله اول:** `B₄ₓ₆ × C₆ₓ₂ = (BC)₄ₓ₂`

```
تعداد ضرب‌ها: 4 × 6 × 2 = 48
```

**مرحله دوم:** `A₃ₓ₄ × (BC)₄ₓ₂`

```
تعداد ضرب‌ها: 3 × 4 × 2 = 24
```

**جمع کل:** `48 + 24 = 72 ضرب`

---

### نتیجه‌گیری:

✅ **ترتیب بهینه:** `(A(BC))` با **72 ضرب**  
❌ **ترتیب غیربهینه:** `((AB)C)` با **108 ضرب**

---

## تمرین 📝

### سوال:

اگر `A₃₀ₓ₁₀`, `B₁₀ₓ₄₀`, `C₄₀ₓ₁₀`, `D₁₀ₓ₂₅` باشد، **حداقل تعداد ضرب‌ها** را برای محاسبه `A×B×C×D` به دست آورید.

**راهنمایی:** تمام ترتیب‌های ممکن را بررسی کنید و کمترین تعداد عملیات را پیدا کنید.

---

## ماتریس اسپارس (Sparse Matrix) - ماتریس پراکنده

### تعریف:

**ماتریس اسپارس:** ماتریسی که تعداد زیادی از عناصر آن **صفر** هستند.

---

### مشکل ذخیره‌سازی معمولی:

برای ماتریس `m×n` که اکثر عناصر آن صفر هستند:

- **حافظه تلف‌شده:** ذخیره تمام صفرها
- **عملیات اضافی:** محاسبه روی صفرها

---

### روش بهینه: نمایش سه‌تایی (Triplet Representation)

برای هر عنصر **غیرصفر**، سه مقدار ذخیره می‌شود:

```
[سطر | ستون | مقدار]
```

---

### مثال عملی:

#### ماتریس اصلی (5×5):

```
     0  1  2  3  4
   ┌─────────────┐
0  │ 2  0  4  0  0 │
1  │ 0  0  0  0  0 │
2  │ 0  2  0  0  0 │
3  │ 5  0  0  0  1 │
4  │ 0  0  0  2  0 │
   └─────────────┘
```

**تعداد عناصر غیرصفر:** 7 عنصر

---

#### ماتریس اسپارس (3×6):

```
     0  1  2
   ┌─────────┐
0  │ 0  0  2 │  ← (ماتریس اصلی)
1  │ 0  2  4 │     سطر اول/آخر
2  │ 2  1  2 │
3  │ 3  0  5 │
4  │ 3  4  2 │
5  │ 4  3  2 │
   └─────────┘
    ↑  ↑  ↑
  سطر ستون مقدار
```

**ابعاد:** `3×6`

**توضیح:**

- **سطر 0:** اطلاعات ماتریس اصلی (5 سطر، 5 ستون، 7 عنصر غیرصفر)
- **سطرهای بعدی:** هر سطر یک عنصر غیرصفر را نمایش می‌دهد

---

### مزایای ماتریس اسپارس:

1. **صرفه‌جویی در حافظه:**
    
    - به جای `m×n`، فقط `3×k` (k = تعداد عناصر غیرصفر)
2. **سرعت بیشتر:**
    
    - عملیات فقط روی عناصر غیرصفر انجام می‌شود
3. **کاربرد:**
    
    - گراف‌های پراکنده
    - شبکه‌های عصبی
    - معادلات دیفرانسیل

---

### فرمول محاسبه صرفه‌جویی:

```
اگر تعداد صفرها > (m×n)/2 باشد
→ استفاده از ماتریس اسپارس مقرون به صرفه است
```

---

## خلاصه نکات ⭐

### بهینه‌سازی ضرب ماتریس:

- ترتیب ضرب مهم است
- محاسبه تعداد عملیات برای هر ترتیب
- انتخاب ترتیبی با کمترین ضرب

### ماتریس اسپارس:

- برای ماتریس‌های خلوت (با صفرهای زیاد)
- نمایش سه‌تایی: [سطر، ستون، مقدار]
- صرفه‌جویی قابل توجه در حافظه و زمان